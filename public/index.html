<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Portfolio Sim</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body class="bg">
  <header class="brandbar">
    <div class="brand-left">
      <img src="/assets/Kent_Invest_Logo.png" alt="Kent Invest" class="brandlogo" />
      <div class="brandtitle">Portfolio Sim</div>
    </div>
    <div class="brand-right">
      <div class="hud-cluster">
        <div class="hud-line">
          <span id="connectionBadge" class="pill hud-pill" data-state="connecting">Connecting…</span>
          <span id="phaseBadge" class="pill hud-pill">Phase: Lobby</span>
          <span id="scenarioLabel" class="pill hud-pill">Scenario: loading…</span>
        </div>
      </div>
      <div class="brand-actions">
        <div class="brand-metrics">
          <div class="metric">
            <span class="metric-label">Position Value</span>
            <span id="posLbl" class="metric-value">0</span>
          </div>
          <div class="metric">
            <span class="metric-label">Available Cash</span>
            <span id="cashLbl" class="metric-value">0</span>
          </div>
          <div class="metric">
            <span class="metric-label">Open PnL</span>
            <span id="openPnlLbl" class="metric-value">0.00</span>
          </div>
          <div class="metric">
            <span class="metric-label">Total PnL</span>
            <span id="pnlLbl" class="metric-value">0.00</span>
          </div>
        </div>
        <button id="gameFullscreenBtn" type="button" class="fullscreen-btn" data-fullscreen>Enter Fullscreen</button>
      </div>
    </div>
  </header>



  <section id="runErrorView" class="center hidden">
    <div class="card result-card">
      <h2>Missing run_id. Please launch from Mint.</h2>
      <p class="muted">This simulation must be opened from a Mint run link.</p>
      <div class="result-actions">
        <a id="mintHomeLink" class="button-link" href="#">Back to Mint homepage</a>
      </div>
    </div>
  </section>

  <!-- JOIN -->
  <section id="joinView" class="center">
    <div class="card">
      <h1>Join the Market</h1>
      <div class="row">
        <input id="nameInput" placeholder="Your name" />
        <button id="joinBtn">Join</button>
      </div>
      <p class="muted" id="joinMsg">Enter your name to join the waiting room.</p>
      <button id="joinFullscreenBtn" type="button" class="fullscreen-btn" data-fullscreen>Enter Fullscreen</button>
    </div>
  </section>

  <!-- WAITING ROOM (shows roster) -->
  <section id="waitView" class="center hidden">
    <div class="card">
      <h2>Waiting for host to start…</h2>
      <p class="muted">You’re in. You’ll switch automatically when the game starts.</p>
      <h3>Players joined</h3>
      <ul id="roster" class="roster"></ul>
      <button id="waitFullscreenBtn" type="button" class="fullscreen-btn" data-fullscreen>Enter Fullscreen</button>
    </div>
  </section>

  <!-- GAME -->
  <section id="gameView" class="page hidden">
    <div class="game-shell">
      <div class="left-col">
        <div class="market-layout">
          <div class="panel card side-widget assets-card">
            <div class="panel-header">
              <h3>Assets</h3>
              <span id="assetSubheading" class="muted small-text">Select an asset to trade</span>
            </div>
            <div class="asset-tabs" id="assetTabs"></div>
            <div class="side-widget-body assets-body">
              <div class="assets-header">
                <span>Ticker</span>
                <span>Price</span>
                <span>Position</span>
                <span>PnL</span>
              </div>
              <div id="assetsList" class="assets-list"></div>
            </div>
          </div>

          <div class="market-main">
            <div class="panel card chart-card">
              <div class="panel-header">
                <h3>Price Chart</h3>
                <div class="panel-tools">
                  <span class="mode-label">Candlesticks</span>
                  <span id="chartModeBadge" class="pill pill-mode">—</span>
                </div>
              </div>
              <div class="chart-wrap">
                <div id="chart" class="chart-surface"></div>
              </div>
            </div>

            <div class="trade-stack">
              <div class="panel card trade-card">
                <div class="panel-header trade-header">
                  <h3>Order Entry <span id="orderAssetLabel" class="order-asset-label">—</span></h3>
                </div>
                <form id="tradeForm" class="trade-form">
                  <div class="form-row form-row-qty">
                    <label for="quantityInput">Volume</label>
                    <input id="quantityInput" type="number" step="1" min="1" value="1" />
                  </div>
                  <div class="form-actions compact-actions">
                    <button type="button" id="sellBtn" class="sell">Sell</button>
                    <button type="button" id="buyBtn" class="buy">Buy</button>
                  </div>
                </form>
              </div>
              <div class="panel card placeholder-card"></div>
            </div>
          </div>
        </div>
      </div>
      <aside class="right-col">
        <div class="panel card result-panel" id="resultPanel">
          <div class="panel-header">
            <h3>Run Submission</h3>
            <span class="muted small-text" id="runIdLabel">Run: —</span>
          </div>
          <p id="resultMessage" class="muted">Results will be submitted when the round ends.</p>
          <div id="resultActions" class="result-actions"></div>
          <button id="submitTestBtn" class="secondary hidden" type="button">Submit test results</button>
        </div>
        <div class="panel card news-panel">
          <div class="panel-header">
            <h3>News</h3>
            <span class="muted small-text">Live headlines</span>
          </div>
          <div id="newsFeed" class="news-body">
            <div class="news-item">
              <strong>Market feed</strong>
              <span class="muted">Awaiting the next headline...</span>
            </div>
          </div>
        </div>
      </aside>
    </div>
  </section>

  <script src="/socket.io/socket.io.js"></script>
  <script src="/app-config.js"></script>
  <script src="https://unpkg.com/lightweight-charts@4.2.1/dist/lightweight-charts.standalone.production.js"></script>
  <script type="module" src="script.js"></script>
</body>
</html>
